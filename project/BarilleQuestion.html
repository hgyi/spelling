<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>BRAILLE</title>

    <!-- Bootstrap Core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700" rel="stylesheet" type="text/css">
</head>

<body style="background-color: #ffc299">
    <img id="exit" src="img/questionBtn/Exit.png" class="rounded" style="width: 20%;">
	<p id="word" style="margin-top: 100px; margin-bottom: 120px;width: 100%;text-align:center;font-size: 56px;font-weight: 600;color:white"></p>
    <div id="nextBtn" class="text-center">
        <img id="nextImg" src="img/questionBtn/next_orange.png" class="rounded" style="width:  70%;">
    </div>
    <div id="backBtn" class="text-center">
        <img src="img/questionBtn/back.png" class="rounded" style="margin-top: 20px;width: 20%;">
    </div>
	<audio id="audioPlay" src="" hidden></audio> 
	
    <!-- jQuery -->
    <script src="vendor/jquery/jquery.js"></script>
    <!-- Bootstrap Core JavaScript -->
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <!-- Plugin JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/3.5.2/firebase.js"></script>
	<!-- google api -->
    <script src="http://www.google.com/jsapi"></script>
    <!-- webduino api -->
    <script src="http://blockly.webduino.io/components/webduino-js/dist/webduino-all.min.js"></script>
    <script src="http://blockly.webduino.io/lib/webduino-blockly.js"></script>
    <script src="http://blockly.webduino.io/lib/runtime.min.js"></script> 
    
	<script>
		//計算正確數字以及目前多少題目
        var rfid;
        var servo;
		var questionCount = 1;
		var answerCorectCount = 0;
        var url = new URL(window.location.href);
        var type = url.searchParams.get("type");
        var level = url.searchParams.get("level");
        var randWord = [];
		
        if (type === "foods") {
            $("body").css("background-color","#ffc299");
            $("#nextImg").attr("src","img/questionBtn/next_orange.png");
            
            if(level === "easy"){
                randWord =  ["Apple","Cake"];
            } else {
                randWord =  ["Lollipop"];
            }
        } else if (type === "traffic") {
            $("body").css("background-color","#3c7faf");
            $("#nextImg").attr("src","img/questionBtn/next_blue.png");

            if(level === "easy"){
                randWord =  ["Bike","Car"];
            } else {
                randWord =  ["Baggage"];
            }
        } else if (type === "stationery") {
            $("body").css("background-color","#b6dab4");
            $("#nextImg").attr("src","img/questionBtn/next_green.png");

            if(level === "easy"){
                randWord =  ["Book","Bag"];
            } else {
                randWord =  ["Paperclip"];
            }
        } else if (type === "animals") {
            $("body").css("background-color","#f19b97");
            $("#nextImg").attr("src","img/questionBtn/next_red.png");

            if(level === "easy"){
                randWord =  ["Bear","Bee"];
            } else {
                randWord =  ["Crocodile"];
            }
        }
        
		var word = document.getElementById("word");
		var audio = document.getElementById("audioPlay");
        
		var answerWord = randWord[Math.floor((Math.random() * randWord.length))];
        var readAnswerWord = "";
        for (var i=0;i<answerWord.length;i++){
            readAnswerWord += "\"" + answerWord[i] + "\" ";
        }
		word.innerHTML = answerWord;

        speak((answerWord + readAnswerWord),["en-US",1,1,0.5]);

        /*
        audio.src = "https://google-translate-proxy.herokuapp.com/api/tts?query=" + answerWord + 
                    "\n" + readAnswerWord + "&language=en&speed=0.5"
		audio.play();
        */
		var inputText = "";

        //Webduino reading rfid
        boardReady({board: 'Smart', device: '10QmRmEd', transport: 'mqtt'}, function (board) {
            board.systemReset();
            board.samplingInterval = 50;
            servo = getServo(board, 4);
            rfid = getRFID(board);
            rfid.read();
            rfid.on("enter",function(_uid){
                rfid._uid = _uid;
                if(rfid._uid == '04553A7AF54880'){
                    //document.getElementById("demo-area-01-show").innerHTML = 'A';
                    userAnswerWordAndRepeat('A');
                }
                if(rfid._uid == '046B7B7AF54881'){
                    //document.getElementById("demo-area-01-show").innerHTML = 'P';
                    userAnswerWordAndRepeat('P');
                }
                if(rfid._uid == '04DB261AF54880'){
                    //document.getElementById("demo-area-01-show").innerHTML = 'L';
                    userAnswerWordAndRepeat('L');
                }
                if(rfid._uid == '0485677AF54881'){
                    //document.getElementById("demo-area-01-show").innerHTML = 'E';
                    userAnswerWordAndRepeat('E');
                }
                //document.getElementById("demo-area-01-show").innerHTML = inputText;
            });
        });

		//Next Button
		var nextBtn = document.getElementById("nextBtn");
		nextBtn.addEventListener("click",function(){
			if (answerWord.toUpperCase() == inputText){
                answerWord = randWord[Math.floor((Math.random() * randWord.length))];
                readAnswerWord = "";
                for (var i=0;i<answerWord.length;i++){
                    readAnswerWord += "\"" + answerWord[i] + "\" ";
                }
                word.innerHTML = answerWord;
                speak((inputText + " Excellent Next " + answerWord + readAnswerWord),["en-US",1,1,0.7]);
                servoFunction();

                /*
                audio.src =  "https://google-translate-proxy.herokuapp.com/api/tts?query=" + inputText + " Excellent Next " + 
                              answerWord + "\n" + readAnswerWord + "&language=en&speed=0.5"
                audio.play();
                */
                questionCount++;
			} else {
                speak(("No Correct Please try again " + answerWord),["en-US",1,1,0.5]);
                /*
                audio.src = "https://google-translate-proxy.herokuapp.com/api/tts?query=No Correct Please try again " + answerWord + "&language=en&speed=0.5"
			    audio.play();
                */
            }
            inputText = '';
		},false);		
		
		function userAnswerWordAndRepeat(word)
        {
            inputText += word;
            speak((word),["en-US",1,1,0.5]);
            /*
            audio.src = "https://google-translate-proxy.herokuapp.com/api/tts?query=" + word + "&language=en&speed=1"
            audio.play();
            document.getElementById("demo-area-01-show").innerHTML = inputText;
            */
        }

        async function servoFunction(){
                servo.angle = 90;
                await delay(1);
                servo.angle = 0;
                await delay(1);
        }
        
        $('#exit').on("click", function(){
            window.location = "./BarilleHome.html"
		});

		/*
        // Initialize Firebase
        var config = {
            apiKey: "AIzaSyD543SM0Hz4TZUJfi2rGj4isE0ysSiintE",
            authDomain: "spelling-5b9a1.firebaseapp.com",
            databaseURL: "https://spelling-5b9a1.firebaseio.com/",
            projectId: "spelling-5b9a1",
            storageBucket: "spelling-5b9a1.appspot.com",
            messagingSenderId: "249319314175"
        };
        firebase.initializeApp(config);
        var database = firebase.database();   

        //取得登入資訊
        var loginUser;
        var jsonObj = [];
        var count = 0;
        firebase.auth().onAuthStateChanged(function(user) {
          if (user) {
            loginUser = user;
            console.log("User is logined", user);
            
          } else {
            loginUser = null;
            alert("User is not logined yet.");
            window.location = "./signIn.html"
          }
        }); 
		*/
	</script>	
</body>

</html>
